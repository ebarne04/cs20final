<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Quiz for Directory Entry</title>
        <link rel= "stylesheet" href="style.css">
        <style type="text/css">
                h1{
                        text-align: center;
                }
                .form-container {
                    max-width: 800px;
                    margin: 0 auto;
                    padding: 50px; 
                    padding-left: 125px;
                    padding-right: 125px;
                    background-color: #f8f8f8;
                    border-radius: 10px;
                    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
                }

                .form-section-label {
                    font-size: 24px;
                    font-weight: bold;
                    text-align: center;
                    margin-top: 10px;
                    margin-bottom: 40px; 
                    color: #333;
                }

                .form-row {
                    display: flex;
                    flex-direction: column;
                    padding: 0;
                }

                .form-group {
                    display: flex;
                    flex-direction: column;
                    text-align: center;
                    margin-bottom: 40px;
                }

                label {
                    font-size: 16px;
                    margin-bottom: 8px; 
                    color: #666;
                }

                input[type="text"],
                input[type="number"],
                input[type="time"],
                select {
                    padding: 10px;
                    border: 1px solid #ccc;
                    border-radius: 8px;
                    font-size: 16px;
                    background-color: #fff;
                    outline: none;
                    box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.1);
                    transition: box-shadow 0.2s;
                    margin: 0;
                }

                .cta-button {
                    width: 100%;
                    padding: 12px;
                    font-size: 18px;
                    color: #fff;
                    background-color: #6496fa;
                    border: none;
                    border-radius: 8px;
                    cursor: pointer;
                    transition: background-color 0.2s;
                    margin-top: 20px;
                }

                /* Error Styling */
                .error {
                    color: #d9534f;
                    font-size: 14px;
                    margin-top: 5px;
                    text-align: left;
                    display: none;
                }
                footer{
                        margin-top: auto;
                }
                @media (max-width: 768px) {
                    .form-container {
                        max-width: 90%; 
                        padding: 20px; 
                    }

                    .form-row {
                        flex-direction: column; 
                    }

                    .form-group {
                        text-align: left;
                        margin-bottom: 20px; 
                    }

                    .cta-button {
                        font-size: 16px; 
                    }
                }
        </style>
    </head>
    <body>
        <nav>
                <div class="logo">
                    <a href="index.html"><img src="Logo.png" alt="Logo"></a>
                </div>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li>
                        <a href="#" class="dropdown">About</a>
                        <ul>
                            <li><a href="about.html">About Us</a></li>
                            <li><a href="testimony.html">Testimonials</a></li>
                            <li><a href="contact.html">Contact</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#" class="dropdown">Database</a>
                        <ul>
                            <li><a href="directory1.php">On-Campus</a></li>
                            <li><a href="directory2.php">Off-Campus</a></li>
                        </ul>
                    </li>
                    <li><a href="quiz.html">Survey</a></li>
                </ul>
        </nav>
        <div class="main-content">
                <h1>Take Our Housing Survey!</h1>
                <div class="form-container">
                        <div class="form-section-label">General Information</div>
                    
                        <div class="form-row">
                            <div class="form-group">
                                <label for="name">Name:</label>
                                <input type="text" id="name" required>
                                <div id="name-error" class="error"></div>
                            </div>
                            <div class="form-group">
                                <label for="hometown">Hometown:</label>
                                <input type="text" id="hometown" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone Number:</label>
                                <input type="text" id="phone" placeholder="ex: 9175558965" required>
                                <div id="phone-error" class="error"></div>
                            </div>
                        </div>
                    
                        <div class="form-row">
                            <div class="form-group">
                                <label for="major">Major:</label>
                                <input type="text" id="major" required>
                            </div>
                            <div class="form-group">
                                <label for="gender">Gender:</label>
                                <select id="gender">
                                    <option value="" disabled selected>Select your gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                    
                        <div class="form-group">
                            <label for="onCampus">Living Location:</label>
                            <select id="onCampus" required>
                                <option value="" disabled selected>Select your location</option>
                                <option value="true">On Campus</option>
                                <option value="false">Off Campus</option>
                            </select>
                            <div id="onCampus-error" class="error"></div>
                        </div>
                    
                        <div class="form-section-label">Personal Preferences</div>
                    
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cleanliness">Cleanliness (1-10):</label>
                                <input type="number" id="cleanliness" min="1" max="10" required>
                                <div id="cleanliness-error" class="error"></div>
                            </div>
                        </div>
                    
                        <div class="form-row">
                            <div class="form-group">
                                <label for="wakeup">Wakeup Time:</label>
                                <input type="time" id="wakeup" required>
                            </div>
                            <div class="form-group">
                                <label for="bedtime">Bedtime:</label>
                                <input type="time" id="bedtime" required>
                            </div>
                        </div>
                    
                        <div class="form-row">
                            <div class="form-group">
                                <label for="smoker">Smoker:</label>
                                <select id="smoker">
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                            </div>
                        </div>
                    
                        <button class="cta-button" id="submit_btn">Submit</button>
                        
                
                </div>
                <div id="announcement"></div>
                <div class="result-container" id="results">
                        <br><br><br><br><br><br><br>
                </div>
        </div>

        <script>
                document.getElementById("submit_btn").addEventListener("click", validateAndGenerateResult)
                
                const onCampusPeople = [
                    { name: "Alice", hometown: "Springfield", major: "Computer Science", gender: "Female", cleanliness: 8, img: "person1.png", wakeup:"09:00", bedtime:"23:00", smoker: true },
                    { name: "Bob", hometown: "Hometownville", major: "Physics", gender: "Male", cleanliness: 6, img: "person9.png", wakeup:"09:00", bedtime:"23:00", smoker: true },
                    { name: "Carol", hometown: "Riverton", major: "Mathematics", gender: "Female", cleanliness: 9, img: "person2.png", wakeup: "07:30", bedtime: "22:30", smoker: false },
                    { name: "Dave", hometown: "Lakeside", major: "Biology", gender: "Male", cleanliness: 5, img: "person10.png", wakeup: "08:00", bedtime: "00:00", smoker: false },
                    { name: "Eve", hometown: "Meadowbrook", major: "English", gender: "Female", cleanliness: 7, img: "person3.png", wakeup: "06:45", bedtime: "23:15", smoker: false },
                    { name: "Ginny", hometown: "Lakeview", major: "Mathematics", gender: "Female", cleanliness: 8, img: "person4.png", wakeup: "08:30", bedtime: "23:00", smoker: false },
                    { name: "Nick", hometown: "Brakerston", major: "Biology", gender: "Male", cleanliness: 6.5, img: "person11.png", wakeup: "10:00", bedtime: "00:00", smoker: false },
                    { name: "Mia", hometown: "Springfield", major: "Economics", gender: "Female", cleanliness: 6, img: "person5.png", wakeup: "08:00", bedtime: "23:00", smoker: false },
                    { name: "Noah", hometown: "Hometownville", major: "Computer Science", gender: "Male", cleanliness: 8, img: "person12.png", wakeup: "09:00", bedtime: "00:00", smoker: true },
                    { name: "Olivia", hometown: "Greenfield", major: "Physics", gender: "Female", cleanliness: 7, img: "person6.png", wakeup: "08:00", bedtime: "23:30", smoker: false },
                    { name: "Paul", hometown: "Lakeside", major: "History", gender: "Male", cleanliness: 6, img: "person13.png", wakeup: "07:00", bedtime: "23:00", smoker: true },
                    { name: "Quinn", hometown: "Riverton", major: "Psychology", gender: "Non-binary", cleanliness: 9, img: "person7.png", wakeup: "06:30", bedtime: "22:00", smoker: false },
                    { name: "Jack", hometown: "Bergenfield", major: "Business", gender: "Male", cleanliness: 8, img: "person14.png", wakeup: "8:30", bedtime: "23:00", smoker: false },
                    { name: "Lila", hometown: "Lexington", major: "Biology", gender: "Female", cleanliness: 7, img: "person8.png", wakeup: "10:00", bedtime: "23:30", smoker: true }
                ];

                const offCampusPeople = [
                    { name: "Ella", hometown: "Springfield", major: "Computer Science", gender: "Female", cleanliness: 6, img: "face1.png", wakeup:"09:00", bedtime:"23:00", smoker: true },
                    { name: "Grace", hometown: "Oakville", major: "Psychology", gender: "Female", cleanliness: 8, img: "face2.png", wakeup: "08:30", bedtime: "22:00", smoker: false },
                    { name: "Henry", hometown: "Brookside", major: "Philosophy", gender: "Male", cleanliness: 6, img: "face9.png", wakeup: "09:30", bedtime: "23:30", smoker: true },
                    { name: "Isabel", hometown: "Sunnydale", major: "Psychology", gender: "Female", cleanliness: 10, img: "face3.png", wakeup: "07:00", bedtime: "21:30", smoker: false },
                    { name: "Jack", hometown: "Hilltop", major: "Engineering", gender: "Male", cleanliness: 3, img: "face10.png", wakeup: "06:00", bedtime: "23:45", smoker: false },
                    { name: "Karen", hometown: "Riverside", major: "Political Science", gender: "Female", cleanliness: 7, img: "face4.png", wakeup: "07:15", bedtime: "22:45", smoker: false },
                    { name: "Leo", hometown: "Pinecrest", major: "Business", gender: "Male", cleanliness: 5, img: "face11.png", wakeup: "08:00", bedtime: "23:00", smoker: true },
                    { name: "Riley", hometown: "Sunnydale", major: "Engineering", gender: "Female", cleanliness: 4, img: "face5.png", wakeup: "09:00", bedtime: "01:00", smoker: true },
                    { name: "Sophia", hometown: "Meadowbrook", major: "Art", gender: "Female", cleanliness: 10, img: "face6.png", wakeup: "07:00", bedtime: "22:00", smoker: false },
                    { name: "Tom", hometown: "Brookside", major: "Business", gender: "Male", cleanliness: 5, img: "face12.png", wakeup: "10:00", bedtime: "23:45", smoker: false },
                    { name: "Uma", hometown: "Oakville", major: "Biology", gender: "Female", cleanliness: 8, img: "face7.png", wakeup: "08:30", bedtime: "23:00", smoker: false },
                    { name: "Wilson", hometown: "Pinecrest", major: "Chemistry", gender: "Male", cleanliness: 7, img: "face13.png", wakeup: "09:00", bedtime: "00:30", smoker: true },
                    { name: "Ariella", hometown: "Hilltop", major: "Environmental Science", gender: "Female", cleanliness: 9, img: "face8.png", wakeup: "07:45", bedtime: "22:30", smoker: false },
                    { name: "Jonny", hometown: "Chicago", major: "Biopsychology", gender: "Male", cleanliness: 10, img: "face14.png", wakeup: "08:00", bedtime: "01:00", smoker: false }
                ];

                function timeDiff(t1, t2) {
                        h1 = Number(t1.split(":")[0]);
                        m1 =  Number(t1.split(":")[1]);
                        h2 =  Number(t2.split(":")[0]);
                        m2 =  Number(t2.split(":")[1]);
                        minuteDiff = Math.abs(h1 * 60 + m1 - (h2 *60 + m2));
                        if (minuteDiff > 720) 
                                minuteDiff = 1440 - minuteDiff;
                        return minuteDiff / 60;
                }

                function calculateCompatibility(user, person) {
                        let score = 100;
                        wakeupDiff = timeDiff(user.wakeup, person.wakeup);
                        bedtimeDiff = timeDiff(user.bedtime, person.bedtime);
                        cleanDiff = Math.abs(user.cleanliness - person.cleanliness);
                        if (wakeupDiff > 1) 
                                score -= 5 * wakeupDiff;

                        if (bedtimeDiff > 1)
                                score -= 5 * bedtimeDiff;

                        score -= 3 * cleanDiff;

                        if (user.smoker != person.smoker)
                                score -= 20;

                        return Math.round(score);
                }
                async function validate_phone(num) {
                    const phone = document.getElementById('phone').value;
                    const apiKey = '174c1de16569eb1b62ccdd7be239c78c';
                    const apiUrl = `https://apilayer.net/api/validate?access_key=${apiKey}&number=${phone}&format=1`;

                    try {
                        const response = await fetch(apiUrl);
                        const data = await response.json();
                        console.log(data);
                        return data.valid;
                    } catch (error) {
                        console.error('Error:', error);
                    }
                }
            
                function validateAndGenerateResult() {
                        let valid = true;
                        document.getElementById("name-error").innerText = "";
                        document.getElementById("cleanliness-error").innerText = "";
                        document.getElementById("onCampus-error").innerText = "";
                        document.getElementById("phone").value;

                        const name = document.getElementById("name").value.trim();
                        if (name === "") {
                                document.getElementById("name-error").style.display = "block";
                                document.getElementById("name-error").innerText = "Name is required.";
                                valid = false;
                        }

                        const cleanlinessScore = parseInt(document.getElementById("cleanliness").value, 10);
                        if (isNaN(cleanlinessScore) || cleanlinessScore < 1 || cleanlinessScore > 10) {
                                document.getElementById("cleanliness-error").style.display = "block";
                                document.getElementById("cleanliness-error").innerText = "Cleanliness must be between 1 and 10.";
                                valid = false;
                        }

                        const onCampusSelection = document.getElementById("onCampus").value;
                        if (!onCampusSelection) {
                            document.getElementById("onCampus-error").style.display = "block";    
                            document.getElementById("onCampus-error").innerText = "Please select where you want to live.";
                                valid = false;
                        }
                        // if(!valid) alert("please complete name, location and cleanliness");
                        
                        const phone_number = document.getElementById("phone").value;
                        const phone = document.getElementById("phone").value.trim();
                        if (phone === "" || !/^\d{10}$/.test(phone)) {
                            document.getElementById("phone-error").style.display = "block"
                            document.getElementById("phone-error").innerText = "Please enter a valid 10-digit phone number.";
                            valid = false;
                        } else {
                            formatted_num = "1" + phone_number;
                            phone_valid = validate_phone(formatted_num).PromiseResult;
                            console.log(phone_valid);
                            if (!phone_valid) {
                                console.log("in not valid");
                                document.getElementById("phone-error").style.display = "block"
                                document.getElementById("phone-error").innerText = "Please enter a valid 10-digit phone number.";
                                valid = false;
                            }
                        }
                    
                        if (!valid) return;


                        const user = {wakeup : document.getElementById("wakeup").value, 
                                    bedtime : document.getElementById("bedtime").value, 
                                    smoker : document.getElementById("smoker").value === "true",
                                    cleanliness :cleanlinessScore};
                        
                                    
                        onCampus = onCampusSelection === "true";
                        const peopleList = onCampus ? onCampusPeople : offCampusPeople;

                        const compatibilityArray = peopleList.map(person => ({
                                person,
                                compatibilityScore: calculateCompatibility(user, person)
                        }));
                        compatibilityArray.sort((a, b) => b.compatibilityScore - a.compatibilityScore);
                        
                        document.getElementById("announcement").innerHTML = "<br><br><h1>Here are Your Potential Matches</h1>"
                        let newHTML = "";
                        compatibilityArray.forEach(person => {
                                newHTML += ` <div class="person">
                                                        <img src="${person.person.img}" alt="Photo of ${person.person.name}">
                                                        <h3>${person.person.name} (${person.compatibilityScore}% Match)</h3>
                                                        Hometown: ${person.person.hometown}<br>
                                                        Major: ${person.person.major}<br>
                                                        Gender: ${person.person.gender}<br>
                                                        Cleanliness: ${person.person.cleanliness}/10<br>
                                                        Wakeup: ${person.person.wakeup}<br>
                                                        Bedtime: ${person.person.bedtime}<br>
                                                        Smoker: ${person.person.smoker ? "Yes" : "No"}
                                                </div> `;
                        });
                        document.getElementById("results").innerHTML = newHTML
                }
        </script>
        <footer>
                <div class="left-footer">
                    <img src="Logo.png" alt="Logo">
                    <p style="padding-top: 35px;">&copy; 2024 JumboMate. All Rights Reserved.</p>
                </div>
                <div class="right-footer">
                    <a href= "index.html">Home</a>
                    <a href= "about.html">About Us</a>
                    <a href= "contact.html">Contact</a>
                    <a href= "quiz.html">Quiz</a>
                </div>
            </footer>
    </body>
</html>
